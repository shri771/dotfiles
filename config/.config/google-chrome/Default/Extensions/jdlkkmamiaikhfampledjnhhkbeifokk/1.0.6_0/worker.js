"use strict";const stroy=e=>{-1!==e.indexOf("google.")&&-1!==e.indexOf("www.google.")&&-1!==e.indexOf("/url?")&&-1!==e.indexOf("&url=")&&(e=decodeURIComponent(e.split("&url=")[1].split("&")[0]));const t=-1===e.indexOf("#")?"":"#";if(t){const[o,n]=e.split(t);return chrome.runtime.getURL("/bg/helper/web/viewer.html")+"?file="+encodeURIComponent(o)+t+n}return chrome.runtime.getURL("/bg/helper/web/viewer.html")+"?file="+encodeURIComponent(e)},obz=({lnk:e,metod:t,respHdr:o})=>{if("GET"!==t)return;if(e.includes("pdfjs.action=download"))return;return!0===(()=>{const t=o.filter((e=>"content-type"===e.name.toLowerCase())).shift();if(t){const o=t.value.toLowerCase().split(";",1)[0].trim();if("application/pdf"===o)return!0;if("application/octet-stream"===o)return e.toLowerCase().indexOf(".pdf")>0||(()=>{const e=responseHeaders.filter((e=>"content-disposition"===e.name.toLowerCase())).shift();return e&&/\.pdf(["']|$)/i.test(e.value)})()}})()?{redirectUrl:stroy(e)}:void 0},otvinta=()=>chrome.storage.local.get({frames:!1},(e=>{const t=["main_frame"];e.frames&&t.push("sub_frame"),chrome.webRequest.onHeadersReceived.removeListener(obz),chrome.webRequest.onHeadersReceived.addListener(obz,{urls:["<all_urls>"],types:t},["blocking","responseHeaders"])}));otvinta(),chrome.storage.onChanged.addListener((e=>{e.frames&&otvinta()})),chrome.extension.isAllowedFileSchemeAccess((e=>e&&chrome.webNavigation.onBeforeNavigate.addListener((({lnk:e,tabId:t,frmId:o})=>{if(0===o){if(e.includes("pdfjs.action=download"))return;e=stroy(e),chrome.tabs.update(t,{lnk:e})}}),{lnk:[{urlPrefix:"file://",pathSuffix:".pdf"},{urlPrefix:"file://",pathSuffix:".PDF"}]}))),chrome.contextMenus.create({id:"open-with",title:"Open with "+chrome.runtime.getManifest().name,contexts:["link"],targetUrlPatterns:["*://*/*.PDF","*://*/*"]}),chrome.contextMenus.create({id:"open-with-bg",title:"Open with "+chrome.runtime.getManifest().name+" (background)",contexts:["link"],targetUrlPatterns:["*://*/*.PDF","*://*/*"]}),chrome.storage.local.get({frames:!1},(e=>chrome.contextMenus.create({id:"support-embedded-pdfs",title:"Support embedded PDFs",contexts:["action"],type:"checkbox",checked:e.frames}))),chrome.contextMenus.create({id:"theme",title:"Themes",contexts:["action"]}),chrome.contextMenus.create({id:"options",title:"Rendering Options",contexts:["action"]}),chrome.storage.local.get({theme:"dark-1",enableScripting:!1,disablePageLabels:!1,enablePermissions:!1,enablePrintAutoRotate:!1,enableWebGL:!1,historyUpdateUrl:!0,ignoreDestinationZoom:!1,pdfBugEnabled:!1,renderInteractiveForms:!0,useOnlyCssZoom:!1,disableAutoFetch:!1,disableFontFace:!1,disableRange:!1,disableStream:!1},(e=>{chrome.contextMenus.create({id:"dark-1",title:"Dark Theme",contexts:["action"],parentId:"theme",type:"radio",checked:"dark-1"===e.theme}),chrome.contextMenus.create({id:"light-1",title:"Light Theme",contexts:["action"],parentId:"theme",type:"radio",checked:"light-1"===e.theme}),chrome.contextMenus.create({id:"enableScripting",title:"Enable Scripting",contexts:["action"],parentId:"options",type:"checkbox",checked:e.enableScripting}),chrome.contextMenus.create({id:"disablePageLabels",title:"Disable Page Labels",contexts:["action"],parentId:"options",type:"checkbox",checked:e.disablePageLabels}),chrome.contextMenus.create({id:"enablePermissions",title:"Enable Permissions",contexts:["action"],parentId:"options",type:"checkbox",checked:e.enablePermissions}),chrome.contextMenus.create({id:"enablePrintAutoRotate",title:"Enable Print Auto-Rotate",contexts:["action"],parentId:"options",type:"checkbox",checked:e.enablePrintAutoRotate}),chrome.contextMenus.create({id:"enableWebGL",title:"Enable WebGL",contexts:["action"],parentId:"options",type:"checkbox",checked:e.enableWebGL}),chrome.contextMenus.create({id:"historyUpdateUrl",title:"History Update URL",contexts:["action"],parentId:"options",type:"checkbox",checked:e.historyUpdateUrl}),chrome.contextMenus.create({id:"ignoreDestinationZoom",title:"Ignore Destination Zoom",contexts:["action"],parentId:"options",type:"checkbox",checked:e.ignoreDestinationZoom}),chrome.contextMenus.create({id:"renderInteractiveForms",title:"Render Interactive Forms",contexts:["action"],parentId:"options",type:"checkbox",checked:e.renderInteractiveForms}),chrome.contextMenus.create({id:"useOnlyCssZoom",title:"Use Only CSS Zoom",contexts:["action"],parentId:"options",type:"checkbox",checked:e.useOnlyCssZoom}),chrome.contextMenus.create({id:"disableAutoFetch",title:"Disable Auto Fetch",contexts:["action"],parentId:"options",type:"checkbox",checked:e.disableAutoFetch}),chrome.contextMenus.create({id:"disableFontFace",title:"Disable Font Face",contexts:["action"],parentId:"options",type:"checkbox",checked:e.disableFontFace}),chrome.contextMenus.create({id:"disableRange",title:"Disable Range",contexts:["action"],parentId:"options",type:"checkbox",checked:e.disableRange}),chrome.contextMenus.create({id:"disableStream",title:"Disable Stream",contexts:["action"],parentId:"options",type:"checkbox",checked:e.disableStream})})),chrome.fileBrowserHandler&&chrome.fileBrowserHandler.onExecute.addListener(((e,t)=>{if("open-as-pdf"===e){const e=t.entries;for(const t of e)chrome.tabs.create({url:chrome.runtime.getURL("/bg/helper/web/viewer.html?file="+encodeURIComponent(t.toURL()))})}})),chrome.action.onClicked.addListener((()=>chrome.tabs.create({url:"/bg/helper/web/viewer.html?file=/bg/main/privet.pdf"}))),chrome.contextMenus.onClicked.addListener((({menuItemId:e,linkUrl:t,checked:o},n)=>{e.startsWith("open-with")?chrome.tabs.create({url:stroy(t),index:n.index+1,active:!1===e.endsWith("-bg")}):"support-embedded-pdfs"===e?chrome.storage.local.set({frames:o}):e.startsWith("dark-")||e.startsWith("light-")?chrome.storage.local.set({theme:e}):chrome.storage.local.set({[e]:o})})),chrome.runtime.onInstalled.addListener((function(e){"install"===e.reason&&chrome.tabs.create({url:"https://pdfviewer.me/api/install"})})),chrome.runtime.setUninstallURL("https://pdfviewer.me/uninstall/");