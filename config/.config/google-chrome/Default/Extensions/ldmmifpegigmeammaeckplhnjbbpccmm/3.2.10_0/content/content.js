var e=Object.defineProperty,t=(t,n)=>e(t,"name",{value:n,configurable:!0});function n(e,t){return new Promise(n=>{chrome.runtime.sendMessage({event:e,props:t,destination:"background",v2:!0},e=>{n(e)})})}function o(e){const t=document.createElement(e.tagName);return t.innerHTML=e.innerHTML,t}function i(){const e=window.location.href,t=c();if(!t)return null;return e.replace(/\/u\/\d+/g,"/u/"+t)}async function r(e){const t=i(),n=await f(async()=>g({loadAllEmails:e}),{waitBetweenErrors:300,limit:5});return(null==n?void 0:n.length)?{updatedUrl:t,count:n.length,mails:n}:null}function a(e){try{return new Date(e).toISOString()}catch(t){return null}}function l(e,t,n=document.body){return e!==n&&(!!e.matches(t)||!!e.parentElement&&l(e.parentElement,t,n))}function s(e){return e.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/gi)}function c(){var e,t;return(null==(t=s((null==(e=document.querySelector('[href*="https://accounts.google.com/SignOutOptions?"]'))?void 0:e.outerHTML)??""))?void 0:t[0])??null}function d(e,t){var n;const o=document.querySelector("[role=main] .ha h2").textContent??"",i=e.getAttribute("data-message-id"),r=e.querySelector("img[jid]"),s=r.getAttribute("data-name"),c=r.getAttribute("jid"),d=r.getAttribute("src"),u=a((null==(n=e.querySelector(".gK .g3"))?void 0:n.getAttribute("title"))??""),p=h(e.querySelector("div.ii.gt")??e.querySelector(".adP"),t),m=e.querySelector(".ajA"),f=[...e.querySelectorAll(".aQH > span")].map(e=>{var t,n;try{const o=null==e?void 0:e.getAttribute("download_url"),[i,r,a]=o.match(/([^:]+):([^:]+):(.+)/).slice(1);return{mimeType:i,name:r,downloadUrl:a,readableSize:(null==(n=null==(t=e.querySelector(".aYp span"))?void 0:t.textContent)?void 0:n.trim())??null}}catch(o){return console.error(o),null}}).filter(e=>e);let g;return g=m?[...e.querySelectorAll(".ajA tbody span[email]")].filter(e=>!l(e,".ajA tbody > tr:first-child",m)).map(e=>e.getAttribute("email")).join(", "):[...e.querySelectorAll(".ady > .ajw span[email]")].map(e=>e.getAttribute("email")).join(", "),{id:i,subject:o,authorName:s,authorEmail:c,authorAvatar:d,createdAt:u,attachments:f,recipients:g,content:p}}function u(e){return e.every(e=>{let t=e;for(;t&&!t.matches('[role="listitem"]');)t=t.parentElement;return!!t&&"true"===(null==t?void 0:t.getAttribute("aria-expanded"))})}async function p(e){var t;if(u(e))return;const n=document.querySelector("button.bHI");n&&(null==(t=n.click)||t.call(n),await new Promise(e=>setTimeout(e,1e3)))}function m(e){return new Promise(t=>setTimeout(t,e))}function f(e,t){return new Promise(async(n,o)=>{let i=0;for(;i<t.limit;){try{return void n(await e())}catch(r){console.error("error in repeatUntilNoError",r),await m(t.waitBetweenErrors)}i++}o("limit reached")})}async function g(e){const t=[...document.querySelectorAll('[role="list"] > div')],n=t[t.length-1];return t.length>1&&e.loadAllEmails?(await p(t),t.map(e=>d(e,{removeQuotedArea:!0}))):[d(n,{removeQuotedArea:!1})]}function h(e,t){const n=o(e);return y(n),v(n),t.removeQuotedArea&&w(n),n.innerHTML}function y(e){[...e.querySelectorAll("img[data-emoji]")].forEach(e=>{const t=e.getAttribute("data-emoji"),n=document.createElement("span");n.textContent=t,e.replaceWith(n)})}function w(e){const t=e.querySelector(".gmail_quote");t&&t.remove()}function v(e){[...e.querySelectorAll("[data-is-tooltip-wrapper]")].forEach(e=>e.remove())}t(n,"bgAsk"),t(o,"duplicateElement"),t(i,"getUrlWithEmail"),t(r,"loadGmail"),t(a,"transformToIsoDate"),t(l,"checkParentMatchSelector"),t(s,"extractEmails"),t(c,"getCurrentEmail"),t(d,"parseOne"),t(u,"checkAllHasExpandedParent"),t(p,"optionallyClickOnExpandAll"),t(m,"sleep$1"),t(f,"repeatUntilNoError"),t(g,"getEmailsFromDom"),t(h,"getCleanContent"),t(y,"cleanEmojis"),t(w,"cleanQuotedArea"),t(v,"cleanTooltips");const b=Object.freeze(Object.defineProperty({__proto__:null,loadGmail:r},Symbol.toStringTag,{value:"Module"})),k=t((function(e){return"/"+e}),"assetsURL"),x={},C=t((function e(t,n,o){if(!n||0===n.length)return t();const i=document.getElementsByTagName("link");return Promise.all(n.map(e=>{if((e=k(e))in x)return;x[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(!!o)for(let o=i.length-1;o>=0;o--){const n=i[o];if(n.href===e&&(!t||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script",r.crossOrigin=""),r.href=e,document.head.appendChild(r),t?new Promise((t,n)=>{r.addEventListener("load",t),r.addEventListener("error",()=>n(new Error("Unable to preload CSS for "+e)))}):void 0})).then(()=>t()).catch(e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})}),"preload"),E=class e{constructor(){this.status="closed",this.watchClickOutsideFn=null,this._closeTooltipFn=null}showModal(e){if(e.backdrop){document.getElementById(e.id+"-style")||this.addCssV2(e.id+"-style",`\n        #${e.id}::backdrop {\n          background: rgba(15, 15, 15, 0.6) !important;\n        }\n      `)}const t=document.getElementById(""+e.id);if(t){if(!e.overrideAlreadyExists)return;t.remove()}const n=document.createElement("dialog");n.id=""+e.id,n.setAttribute("style",`\n    all: unset;\n    inset-block-start: 0px;\n    inset-block-end: 0px;\n    max-width: calc((100% - 6px) - 2em);\n    max-height: calc((100% - 6px) - 2em);\n    user-select: text;\n    visibility: visible;\n    overflow: auto;\n    position: fixed;\n    ${"bottom"==e.position?"\n    bottom: 30px;\n    left: auto;\n    top: auto;\n    right:auto;\n    ":""}\n    border: none;\n    background-color: white;\n    position: fixed;\n    /* display: block; */\n    inset-inline-start: 0px;\n    inset-inline-end: 0px;\n    ${e.fullscreen?"\n    width: 100%;\n    height: 100%;\n    ":"\n    width: fit-content;\n    height: fit-content;\n    "}\n    \n    background-color: canvas;\n    color: canvastext;\n    margin: auto;\n    border-width: initial;\n    border-style: solid;\n    border-color: initial;\n    border-image: initial;\n    border: none;\n    background-color:transparent !important;\n    color-scheme: none !important;\n    position: fixed; \n    \n    z-index: ${2147483640+e.zLevel};\n  `),n.innerHTML=`\n  <iframe id="${e.id}-iframe" src="${e.url}" \n  sandbox="allow-scripts allow-same-origin allow-forms allow-popups"\n  style="all:unset; \n  border: 0px;clip: auto;display: block;\n  color-scheme: none !important;\n  ${e.dimension?`\n  height: ${e.dimension.height} !important;\n  width: ${e.dimension.width} !important; \n  `:""}\n  background: transparent !important;opacity:1;transition: opacity 0.4s ease 0s;"></iframe>\n`,document.body.appendChild(n);const o=document.getElementById(e.id);"center"===e.position?o.showModal():"bottom"==e.position&&o.show()}async closeTooltip(){const e=document.getElementById("stn-quick-tooltip");e&&e.remove(),this._closeTooltipFn&&(this._closeTooltipFn=null)}async closeToast(){const e=document.getElementById("stn-toast");e&&e.remove()}async close(){if("closed"===this.status)return;this.status="closed";const e=document.getElementById("stn-quick-modal");e&&e.remove(),document.removeEventListener("click",this.watchClickOutsideFn)}async open(e="main"){if("opened"===this.status)return;this.status="opened";const t=await n("getExtensionContext",{});this.showModal({id:"stn-quick-modal",url:t.modalUrl,position:"center",backdrop:!0,overrideAlreadyExists:!1,dimension:{width:"100%",height:"100%"},fullscreen:!0,zLevel:1});const o=document.getElementById("stn-quick-modal-iframe");this.watchClickOutsideFn=e=>{o.contains(e.target)||this.clickedOutside()},document.addEventListener("click",this.watchClickOutsideFn)}async clickedOutside(){if("none"===document.getElementById("stn-quick-modal").style.display)return;await _e("canCloseDirectly",{})?this.close():_e("showDiscardDialog",{})}autoResize(e){let t=document.getElementById("stn-quick-modal-iframe");e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px")}async showTooltip(){const e=await n("getExtensionContext",{});this.showModal({id:"stn-quick-tooltip",url:e.tooltipUrl,position:"bottom",backdrop:!1,dimension:{width:"200px",height:"44px"},overrideAlreadyExists:!0,zLevel:2}),this._closeTooltipFn=this.watchMouseMoveOutsideElement({id:"stn-quick-tooltip",duration:3e3,onClose:()=>{this.closeTooltip()}})}async showToast(){if(document.getElementById("stn-toast"))return;const e=await n("getExtensionContext",{});this.showModal({id:"stn-toast",url:e.toastUrl,position:"bottom",backdrop:!1,dimension:{width:"380px",height:"60px"},zLevel:2})}addCssV2(e,t){if(document.getElementById(e))return;let n=document.createElement("style");n.type="text/css",n.id=e,n.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(n)}watchMouseMoveOutsideElement({id:e,duration:n,onClose:o}){const i=document.getElementById(e);let r=null;function a(e){i.contains(e.target)?(clearTimeout(r),r=null):r||(r=setTimeout(()=>{l()},n))}function l(){document.removeEventListener("mousemove",a),o()}return t(a,"handleMouseMove"),document.addEventListener("mousemove",a),r=setTimeout(()=>{l()},n),t(l,"closeTooltip"),()=>{l()}}};t(E,"ModalManager");let S=E;function A(){return navigator.platform.indexOf("Mac")>-1}t(A,"isMacintosh");const L="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function M(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n)}function O(e,t,n,o){e.removeEventListener?e.removeEventListener(t,n,o):e.deachEvent&&e.deachEvent("on".concat(t),n)}function T(e,t){const n=t.slice(0,t.length-1);for(let o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function _(e){"string"!=typeof e&&(e="");const t=(e=e.replace(/\s/g,"")).split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function I(e,t){const n=e.length>=t.length?e:t,o=e.length>=t.length?t:e;let i=!0;for(let r=0;r<n.length;r++)-1===o.indexOf(n[r])&&(i=!1);return i}t(M,"addEvent"),t(O,"removeEvent"),t(T,"getMods"),t(_,"getKeys"),t(I,"compareArray");const P={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":L?173:189,"=":L?61:187,";":L?59:186,"'":222,"[":219,"]":221,"\\":220},q={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},j={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},D={16:!1,18:!1,17:!1,91:!1},K={};for(let tt=1;tt<20;tt++)P["f".concat(tt)]=111+tt;let B=[],$=null,F="all";const N=new Map,z=t(e=>P[e.toLowerCase()]||q[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),"code"),H=t(e=>Object.keys(P).find(t=>P[t]===e),"getKey"),U=t(e=>Object.keys(q).find(t=>q[t]===e),"getModifier");function W(e){F=e||"all"}function R(){return F||"all"}function V(){return B.slice(0)}function Q(){return B.map(e=>H(e)||U(e)||String.fromCharCode(e))}function Y(){const e=[];return Object.keys(K).forEach(t=>{K[t].forEach(t=>{let{key:n,scope:o,mods:i,shortcut:r}=t;e.push({scope:o,shortcut:r,mods:i,keys:n.split("+").map(e=>z(e))})})}),e}function Z(e){const t=e.target||e.srcElement,{tagName:n}=t;let o=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(o=!1),o}function G(e){return"string"==typeof e&&(e=z(e)),-1!==B.indexOf(e)}function X(e,t){let n,o;e||(e=R());for(const i in K)if(Object.prototype.hasOwnProperty.call(K,i))for(n=K[i],o=0;o<n.length;)if(n[o].scope===e){n.splice(o,1).forEach(e=>{let{element:t}=e;return ae(t)})}else o++;R()===e&&W(t||"all")}function J(e){let t=e.keyCode||e.which||e.charCode;const n=B.indexOf(t);if(n>=0&&B.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&B.splice(0,B.length),93!==t&&224!==t||(t=91),t in D){D[t]=!1;for(const e in q)q[e]===t&&(ie[e]=!1)}}function ee(e){if(void 0===e)Object.keys(K).forEach(e=>{Array.isArray(K[e])&&K[e].forEach(e=>te(e)),delete K[e]}),ae(null);else if(Array.isArray(e))e.forEach(e=>{e.key&&te(e)});else if("object"==typeof e)e.key&&te(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];let[i,r]=n;"function"==typeof i&&(r=i,i=""),te({key:e,scope:i,method:r,splitKey:"+"})}}t(W,"setScope"),t(R,"getScope"),t(V,"getPressedKeyCodes"),t(Q,"getPressedKeyString"),t(Y,"getAllKeyCodes"),t(Z,"filter"),t(G,"isPressed"),t(X,"deleteScope"),t(J,"clearModifier"),t(ee,"unbind");const te=t(e=>{let{key:t,scope:n,method:o,splitKey:i="+"}=e;_(t).forEach(e=>{const t=e.split(i),r=t.length,a=t[r-1],l="*"===a?"*":z(a);if(!K[l])return;n||(n=R());const s=r>1?T(q,t):[],c=[];K[l]=K[l].filter(e=>{const t=(!o||e.method===o)&&e.scope===n&&I(e.mods,s);return t&&c.push(e.element),!t}),c.forEach(e=>ae(e))})},"eachUnbind");function ne(e,t,n,o){if(t.element!==o)return;let i;if(t.scope===n||"all"===t.scope){i=t.mods.length>0;for(const e in D)Object.prototype.hasOwnProperty.call(D,e)&&(!D[e]&&t.mods.indexOf(+e)>-1||D[e]&&-1===t.mods.indexOf(+e))&&(i=!1);(0!==t.mods.length||D[16]||D[18]||D[17]||D[91])&&!i&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(B),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function oe(e,t){const n=K["*"];let o=e.keyCode||e.which||e.charCode;if(!ie.filter.call(this,e))return;if(93!==o&&224!==o||(o=91),-1===B.indexOf(o)&&229!==o&&B.push(o),["ctrlKey","altKey","shiftKey","metaKey"].forEach(t=>{const n=j[t];e[t]&&-1===B.indexOf(n)?B.push(n):!e[t]&&B.indexOf(n)>-1?B.splice(B.indexOf(n),1):"metaKey"===t&&e[t]&&3===B.length&&(e.ctrlKey||e.shiftKey||e.altKey||(B=B.slice(B.indexOf(n))))}),o in D){D[o]=!0;for(const e in q)q[e]===o&&(ie[e]=!0);if(!n)return}for(const l in D)Object.prototype.hasOwnProperty.call(D,l)&&(D[l]=e[j[l]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===B.indexOf(17)&&B.push(17),-1===B.indexOf(18)&&B.push(18),D[17]=!0,D[18]=!0);const i=R();if(n)for(let l=0;l<n.length;l++)n[l].scope===i&&("keydown"===e.type&&n[l].keydown||"keyup"===e.type&&n[l].keyup)&&ne(e,n[l],i,t);if(!(o in K))return;const r=K[o],a=r.length;for(let l=0;l<a;l++)if(("keydown"===e.type&&r[l].keydown||"keyup"===e.type&&r[l].keyup)&&r[l].key){const n=r[l],{splitKey:o}=n,a=n.key.split(o),s=[];for(let e=0;e<a.length;e++)s.push(z(a[e]));s.sort().join("")===B.sort().join("")&&ne(e,n,i,t)}}function ie(e,n,o){B=[];const i=_(e);let r=[],a="all",l=document,s=0,c=!1,d=!0,u="+",p=!1,m=!1;for(void 0===o&&"function"==typeof n&&(o=n),"[object Object]"===Object.prototype.toString.call(n)&&(n.scope&&(a=n.scope),n.element&&(l=n.element),n.keyup&&(c=n.keyup),void 0!==n.keydown&&(d=n.keydown),void 0!==n.capture&&(p=n.capture),"string"==typeof n.splitKey&&(u=n.splitKey),!0===n.single&&(m=!0)),"string"==typeof n&&(a=n),m&&ee(e,a);s<i.length;s++)r=[],(e=i[s].split(u)).length>1&&(r=T(q,e)),(e="*"===(e=e[e.length-1])?"*":z(e))in K||(K[e]=[]),K[e].push({keyup:c,keydown:d,scope:a,mods:r,shortcut:i[s],method:o,key:i[s],splitKey:u,element:l});if(void 0!==l&&window){if(!N.has(l)){const e=t((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;return oe(e,l)}),"keydownListener"),n=t((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;oe(e,l),J(e)}),"keyupListenr");N.set(l,{keydownListener:e,keyupListenr:n,capture:p}),M(l,"keydown",e,p),M(l,"keyup",n,p)}if(!$){const e=t(()=>{B=[]},"listener");$={listener:e,capture:p},M(window,"focus",e,p)}}}function re(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(K).forEach(n=>{K[n].filter(n=>n.scope===t&&n.shortcut===e).forEach(e=>{e&&e.method&&e.method()})})}function ae(e){const t=Object.values(K).flat();if(t.findIndex(t=>{let{element:n}=t;return n===e})<0){const{keydownListener:t,keyupListenr:n,capture:o}=N.get(e)||{};t&&n&&(O(e,"keyup",n,o),O(e,"keydown",t,o),N.delete(e))}if(t.length<=0||N.size<=0){if(Object.keys(N).forEach(e=>{const{keydownListener:t,keyupListenr:n,capture:o}=N.get(e)||{};t&&n&&(O(e,"keyup",n,o),O(e,"keydown",t,o),N.delete(e))}),N.clear(),Object.keys(K).forEach(e=>delete K[e]),$){const{listener:e,capture:t}=$;O(window,"focus",e,t),$=null}}}t(ne,"eventHandler"),t(oe,"dispatch"),t(ie,"hotkeys"),t(re,"trigger"),t(ae,"removeKeyEvent");const le={getPressedKeyString:Q,setScope:W,getScope:R,deleteScope:X,getPressedKeyCodes:V,getAllKeyCodes:Y,isPressed:G,filter:Z,trigger:re,unbind:ee,keyMap:P,modifier:q,modifierMap:j};for(const tt in le)Object.prototype.hasOwnProperty.call(le,tt)&&(ie[tt]=le[tt]);if("undefined"!=typeof window){const e=window.hotkeys;ie.noConflict=t=>(t&&window.hotkeys===ie&&(window.hotkeys=e),ie),window.hotkeys=ie}const se={css:({idName:e})=>`\n    #floating-button-${e} {\n    }\n    #floating-button-open-${e}:hover {\n    }\n    #floating-button-close-${e} {\n        opacity: 0 !important;\n        transition: opacity 0.1s ease-in-out !important;\n    }\n    #floating-button-${e}:hover #floating-button-close-${e} {\n        opacity: 1 !important;\n    }\n    `,html:({idName:e})=>`\n    <div id="floating-${e}" style="all:unset; position:fixed; z-index: 2147483646;">\n  </div>`},ce={html:({idName:e})=>`\n  <div id="floating-button-${e}" style="all:unset; border: 0px; border-radius: 999px; box-shadow: rgba(0, 0, 0, 0.25) 0px 0px 0px 5px;\n  position:relative;\n  display: flex;\n  transition: opacity 0.1s ease-in-out;\n  align-items: center;\n  width: fit-content;\n  ">\n  <button \n  id="floating-button-close-${e}"\n  style="\n  all:unset;\n  position: absolute;\n  z-index: 2;\n  color:'white';\n  display: flex;\n  top:-3px;\n  left:-3px;\n  padding: 3px;\n  justify-content: center;\n  align-items: center;border-radius: 19px;\n  background-color: rgba(0, 0, 0, 0.7);\n  text-align: left;\n  cursor: pointer;\n  ">\n    <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M8.77767 8.3565L12.2082 11.7871C12.2615 11.8434 12.2909 11.9182 12.2902 11.9957C12.2895 12.0744 12.2579 12.1496 12.2023 12.2052C12.1467 12.2609 12.0715 12.2924 11.9928 12.2931C11.9152 12.2938 11.8405 12.2644 11.7842 12.2112L8.35358 8.78059L8.00002 8.42704L7.64647 8.78059L4.21589 12.2112C4.15957 12.2644 4.08481 12.2938 4.00725 12.2931C3.92859 12.2924 3.85335 12.2609 3.79772 12.2052C3.7421 12.1496 3.71055 12.0744 3.70987 11.9957C3.70919 11.9182 3.73858 11.8434 3.7918 11.7871L7.22238 8.3565L7.57593 8.00295L7.22238 7.64939L3.78803 4.21505C3.78801 4.21503 3.788 4.21501 3.78798 4.21499C3.73177 4.15874 3.7002 4.08247 3.7002 4.00295C3.7002 3.92345 3.73175 3.8472 3.78792 3.79095C3.78794 3.79093 3.78796 3.79092 3.78798 3.7909C3.788 3.79088 3.78801 3.79086 3.78803 3.79085C3.84428 3.73467 3.92053 3.70312 4.00002 3.70312C4.07955 3.70312 4.15582 3.73469 4.21207 3.7909C4.21209 3.79092 4.21211 3.79093 4.21212 3.79095L7.64647 7.2253L8.00002 7.57885L8.35358 7.2253L11.788 3.7909L11.788 3.79095L11.7941 3.7847C11.8217 3.75605 11.8548 3.73319 11.8914 3.71747C11.928 3.70175 11.9674 3.69347 12.0072 3.69313C12.0471 3.69278 12.0866 3.70037 12.1235 3.71546C12.1603 3.73054 12.1938 3.75281 12.222 3.78098C12.2502 3.80915 12.2724 3.84265 12.2875 3.87952C12.3026 3.91639 12.3102 3.95589 12.3098 3.99572C12.3095 4.03556 12.3012 4.07492 12.2855 4.11152C12.2698 4.14812 12.2469 4.18123 12.2183 4.2089L12.2182 4.20885L12.2121 4.21499L8.77767 7.64939L8.42412 8.00295L8.77767 8.3565Z" fill="white" stroke="white"/>\n</svg>\n  </button>\n  <div id="floating-button-open-${e}" style="\n  all:unset;\n  cursor: pointer; \n  justify-items: center;\n  transition: opacity 0.1s ease-in-out;\n  display: flex;\n  align-items: center;\n  width: fit-content;\n  background-color:#fff;\n  padding: 16px; \n  border-radius:999px;\n  ">\n  <svg width="24" height="24" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M2.275 17.55L6.46262 20.722L21.0876 14.222L9.75 23.1579V34.125C9.75034 34.4581 9.85305 34.7831 10.0442 35.0559C10.2354 35.3287 10.5058 35.5361 10.8188 35.6501C11.1318 35.7642 11.4722 35.7792 11.7941 35.6933C12.1159 35.6074 12.4036 35.4247 12.6181 35.1699L17.7044 29.1265L28.275 37.05C28.4942 37.2149 28.7517 37.3216 29.0233 37.3601C29.2949 37.3987 29.5718 37.3679 29.8283 37.2705C30.0847 37.1732 30.3124 37.0125 30.49 36.8035C30.6677 36.5944 30.7895 36.3438 30.8441 36.075L37.3441 3.57498C37.4017 3.28788 37.3806 2.99056 37.2831 2.71446C37.1856 2.43836 37.0153 2.19373 36.7902 2.00644C36.5651 1.81915 36.2936 1.69615 36.0044 1.65046C35.7152 1.60477 35.419 1.63807 35.1471 1.74686L2.64712 14.7469C2.38051 14.8544 2.14721 15.0308 1.97103 15.258C1.79484 15.4851 1.68208 15.755 1.64424 16.04C1.60641 16.325 1.64486 16.6149 1.75567 16.8802C1.86648 17.1455 2.04569 17.3766 2.275 17.55V17.55Z" fill="#44403C" />\n  </svg>\n  </div>\n</div>`};function de(e){let t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)}function ue(e){var t=document.createElement("div");return t.innerHTML=e,t.children[0]}function pe(e,t){const n=ue(e.html(t));return Object.keys(t).map(e=>{let o=n.querySelector("#btn-"+e);o&&o.addEventListener("click",()=>{t[e]()})}),e.css&&de(e.css),n}t(de,"addCss2"),t(ue,"htmlString2El"),t(pe,"comp2El");const me={css:"",html:({})=>'<div style="width:20px;height:20px; background-color:red; border-radius:4px;gap: 4px;"></div>'},fe={css:"",html:({idName:e})=>`<div id="top-left-box-${e}" style="\n    all:unset;\n    cursor: pointer; \n    justify-items: center;\n    display: flex;\n    position:absolute;\n    align-items: center;\n    width: fit-content;\n    background-color:transparent;\n    left:10px;\n    top:10px;\n    ">\n    </div>\n`};function ge(){document.getElementById("floating-button-stn")&&Ce("#floating-button-stn")}function he(){document.getElementById("floating-dialog-stn")&&Ce("#floating-dialog-stn")}let ye;async function we(){null==ye||ye(),xe.turnOffShowAnimation()}function ve(e){return"number"==typeof e?e+"px":e}async function be(e){document.getElementById("floating-button-stn")||ke(e)}function ke(e,t){var n,o;const i=document.getElementById("floating-stn");if(!i)throw"Can't find floating element";e&&(e.left&&(i.style.left=ve(e.left)),e.right&&(i.style.right=ve(e.right)),e.top&&(i.style.top=ve(e.top)),e.bottom&&(i.style.bottom=ve(e.bottom)));let r=document.getElementById("floating-button-stn");if(r){const e=pe(ce,{idName:"stn"});r.innerHTML=e.innerHTML}else r=pe(ce,{idName:"stn"}),i.appendChild(r);const a=r.querySelector("#floating-button-open-stn");a&&(t||(a.style.opacity="0",setTimeout(()=>{a.style.opacity="1"},20)),null==(n=document.querySelector("#floating-button-close-stn"))||n.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),ge()})),null==(o=document.querySelector("#floating-button-open-stn"))||o.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),we()})))}t(ge,"closeFloatingDialog"),t(he,"closeFloatingButtonDialog"),t(we,"openFloatingDialog"),t(ve,"toPixel"),t(be,"injectFloatingQuickAddButton"),t(ke,"renderFloatingQuickAddNormalButton");const xe={open(){be({left:"20px",bottom:"50px"})},close(){const e=document.getElementById("floating-button-stn");if(e){const t=e.querySelector("#floating-button-open-stn");if(!t)return;t.style.opacity="0",setTimeout(()=>{e.remove()},250)}},closeDialog(){he(),be({left:"20px",bottom:"50px"}),ke({left:"20px",bottom:"50px"})},openDialog:()=>(xe.open(),we()),turnOnShowAnimation(){console.log("turnOnShowAnimation"),be({left:"20px",bottom:"50px"})},turnOffShowAnimation(){if(document.getElementById("floating-dialog-stn"))return!1;xe.close()},addTopLeftBox(){let e=document.getElementById("top-left-box-stn")||pe(fe,{idName:"stn"});const t=pe(me,{});e.appendChild(t),document.body.appendChild(e)}};function Ce(e){var t;const n=document.querySelector(e);if(!n)throw`el '${e}' not found`;null==(t=n.parentNode)||t.removeChild(n)}t(Ce,"removeDomElem");let Ee=!1,Se=null;const Ae=t(e=>{if(e.clientX<=80&&e.clientY>=window.innerHeight-150){if(Ee)return void(Se&&(clearTimeout(Se),Se=null));Ee=!0,xe.turnOnShowAnimation()}else{if(!Ee)return;if(Se)return;Se=setTimeout(()=>{xe.turnOffShowAnimation(),Se=null,Ee=!1},500)}},"mouseMoveHandler");function Le(){window.addEventListener("mousemove",Ae)}function Me(){window.removeEventListener("mousemove",Ae)}t(Le,"listenToMouseMove"),t(Me,"removeListenToMouseMove");const Oe=class e{constructor(){this.state="closed"}initFloating(e){ye=e;let t=document.getElementById("floating-stn");return t||(t=pe(se,{idName:"stn"}),document.body.appendChild(t),Le(),this.state="opened"),t}stopFloating(){Ce("#floating-stn"),Me(),this.state="closed"}};t(Oe,"FloatingManager");let Te=Oe;function _e(e,t){return new Promise(n=>{chrome.runtime.sendMessage({v2:!0,destination:"modal",event:e,props:t},e=>{n(e)})})}t(_e,"modalAsk");const Ie=class e{constructor(e){this.status="stopped",this.macintosh=A(),this.clicked=!1,this.onTriggerFn=e.onTrigger}stop(){this.status="stopped",ie.unbind("ctrl+j,cmd+j")}start(){this.status="running",ie("ctrl+j,cmd+j",e=>{this.onTriggerFn(),e.preventDefault(),e.stopPropagation(),this.clicked=!0})}};t(Ie,"QuickCaptureWatcher");let Pe=Ie;async function qe(e){if(e in window.__stnModule)return window.__stnModule[e];const t={gmail:()=>C(()=>Promise.resolve().then(()=>b),void 0)},n=await t[e]();return window.__stnModule[e]=n,n}t(qe,"loadModule");let je=!1;function De(e,t,n){return"content"!=e.destination||je?"iframe"==e.destination?(je=!0,new Promise(async o=>{var i;console.debug("[content]",e),(null==(i=Xe[e.event])?void 0:i.call(Xe,e.props)).then(o=>{console.debug("send response back",e,o,n,t),n(o)})}),!0):void 0:(new Promise(async o=>{var i;console.debug("[content]",e),(null==(i=Je[e.event])?void 0:i.call(Je,e.props)).then(o=>{console.debug("send response back",e,o,n,t),n(o)})}),!0)}function Ke(){const e=chrome.runtime.onMessage.hasListener(De);console.log("check",e),e||chrome.runtime.onMessage.addListener(De),window.quickCaptureWatcher||(window.modalManager=new S,window.quickCaptureWatcher=new Pe({onTrigger:()=>{Je.showModal()}}),window.floatingManager=new Te)}function Be(e,t,o){return n("iframeAsk",{url:e,event:t,properties:o})}function $e(e){const t=new Date,n=e.match(/^(\d+)(w|d|h|m|y)\s*.*/);if(!n)return console.error("Invalid date format:",e),null;const o=parseInt(n[1],10),i=n[2];switch(i){case"w":t.setDate(t.getDate()-7*o);break;case"d":t.setDate(t.getDate()-o);break;case"h":t.setHours(t.getHours()-o);break;case"m":t.setMonth(t.getMonth()-o);break;case"y":t.setFullYear(t.getFullYear()-o);break;default:return console.error("Invalid time period in date:",i),null}return t.toISOString().split("T")[0]}function Fe(e){const n=$e(e);if(n)return n;const o=(new Date).toISOString().split("T")[0],i=(new Date).getFullYear().toString();function r({days:e=0,weeks:t=0,months:n=0,years:o=0}){let i=new Date;return i.setDate(i.getDate()-e),i.setDate(i.getDate()-7*t),i.setMonth(i.getMonth()-n),i.setFullYear(i.getFullYear()-o),i.toISOString().split("T")[0]}t(r,"getPastDate");let a=e;if(e.includes("hour"))a=o;else if(e.includes("day")||e.includes("d")){a=r({days:parseInt(e.split(" ")[0],10)})}else if(e.includes("week")){a=r({weeks:parseInt(e.split(" ")[0],10)})}else if(e.includes("month")){a=r({months:parseInt(e.split(" ")[0],10)})}else if(e.includes("year")){a=r({years:parseInt(e.split(" ")[0],10)})}else{const t=e.split("-");if(2===t.length){let[e,n]=t;e=e.padStart(2,"0"),n=n.padStart(2,"0"),a=`${i}-${e}-${n}`}else if(3===t.length){let[e,n,o]=t;n=n.padStart(2,"0"),o=o.padStart(2,"0"),a=`${e}-${n}-${o}`}}return a}function Ne(e){var t;return e&&(null==(t=null==e?void 0:e.trim)?void 0:t.call(e).length)?e.includes("K")?parseInt(1e3*parseFloat(e.replace("K","")),10):e.includes("M")?parseInt(1e6*parseFloat(e.replace("M","")),10):parseInt(e.replace(",",""),10):0}function ze(e,t){try{const n=Ue(e,t);if(n)return n.innerText.trim()}catch(n){console.error(n)}return""}async function He(e){var t;const n=[["iframe","carousel"],["div.update-components-video","video"],["div.update-components-linkedin-video","video"],[".feed-shared-update-v2__update-content-wrapper","article"],["div.update-components-image","image"],["article.update-components-article","article"],["div.feed-shared-external-video__meta","video"],["div.feed-shared-mini-update-v2 feed-shared-update-v2__update-content-wrapper artdeco-card","Shared Post"],["div.feed-shared-poll ember-view","Other: Poll, Shared Post, etc"]];for(const[o,i]of n){const n=e.querySelector(o);if(console.debug("elem",n),n){const o=n.querySelector("a[href]");if(n.querySelector("img[src]"),"carousel"==i){console.debug("iframe",n,n.frameId,n.id);const e=await Be(n.src,"getCarouselImages",{});return console.debug("iframe response",e),e}if("article"==i)return{id:"",url:null,type:"article"};if("image"==i)return[...e.querySelectorAll("img.update-components-image__image")].map((e,t)=>({id:"photo-"+(t+1),width:e.width,url:e.src,type:"photo",height:e.height}));if("video"==i){const e=null==(t=n.querySelector("video"))?void 0:t.getAttribute("poster"),i={id:"video",url:null==o?void 0:o.href,type:"video",videoUrl:null==o?void 0:o.href};return(null==e?void 0:e.length)?[{id:"video-poster",url:e,type:"photo"},i]:i}return null}}return null}function Ue(e,t){for(const n of t){const t=e.querySelector(n);if(t)return t}return null}async function We(e){var t,n,o,i,r,a,l,s,c,d,u,p,m,f,g,h,y;const w=ze(e,["div.feed-shared-update-v2__description-wrapper",".update-components-text"]),v=e.getAttribute("data-urn"),b=await He(e),k=Array.isArray(b)?b:b?[b]:[],x=(null==(n=null==(t=Ue(e,[".update-components-actor__sub-description-link",".update-components-actor__sub-description"]))?void 0:t.parentNode)?void 0:n.parentNode)??Ue(e,[".update-components-actor",".update-components-actor__container",".update-components-actor--with-control-menu"]),C=null==x?void 0:x.querySelector(".update-components-actor__meta-link"),E=null==C?void 0:C.getAttribute("aria-label").replace("View: ","").trim(),S=null==(o=E.split("•")[0])?void 0:o.trim(),A=null==(i=E.split("•")[1])?void 0:i.trim(),L=null==(r=null==x?void 0:x.querySelector("img"))?void 0:r.src;let M=Fe(ze(e,[".update-components-actor__sub-description-link",".update-components-actor__sub-description"]));const O=Array.from(e.querySelectorAll("button[aria-label]")),T=O.filter(e=>{var t;return null==(t=e.getAttribute("aria-label"))?void 0:t.toLowerCase().includes("reaction")}),_=(null==(l=null==(a=T[0])?void 0:a.textContent)?void 0:l.trim())??(null==(c=null==(s=T[1])?void 0:s.textContent)?void 0:c.trim())??0,I=O.filter(e=>{var t;return null==(t=e.getAttribute("aria-label"))?void 0:t.toLowerCase().includes("comment")}),P=(null==(u=null==(d=I[0])?void 0:d.textContent)?void 0:u.trim())??(null==(m=null==(p=I[1])?void 0:p.textContent)?void 0:m.trim())??0,q=O.filter(e=>{var t;return null==(t=e.getAttribute("aria-label"))?void 0:t.toLowerCase().includes("repost")}),j=(null==(g=null==(f=q[0])?void 0:f.textContent)?void 0:g.trim())??(null==(y=null==(h=q[1])?void 0:h.textContent)?void 0:y.trim())??0;return{title:Qe(w,k.length>0),text:w,medias:k,createdAt:M,url:`https://www.linkedin.com/feed/update/${v}/`,author:{name:S,subtitle:A,image:L,url:null==C?void 0:C.href},reactionsCount:Ne(_),commentsCount:Ne(P),sharesCount:Ne(j)}}async function Re(){await Ve(10);const e=Array.from(document.querySelectorAll("div.feed-shared-update-v2")).filter(e=>{var t;return null==(t=e.getAttribute("data-urn"))?void 0:t.includes("activity")}),t=Ye(e),n=(null==e?void 0:e.length)&&await We(e[t])||null;return console.debug("x",document,n,t),n}function Ve(e){return new Promise(t=>setTimeout(t,e))}function Qe(e,t=!1){const n=t?250:400,o=t?3:5,i=e.replace(/\r\n|\r|\n/g,"\n");i.split("\n");let r=i.slice(0,n);const a=r.split("\n");return a.length>o&&(r=a.slice(0,o).join("\n")),r}function Ye(e){let t=0,n=-1;return e.forEach((e,o)=>{const i=e.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight,a=window.innerWidth||document.documentElement.clientWidth,l=Math.max(0,Math.min(i.right,a)-Math.max(i.left,0))*Math.max(0,Math.min(i.bottom,r)-Math.max(i.top,0));l>t&&(t=l,n=o)}),n}async function Ze(){const e=[...document.body.querySelectorAll("li img")];return e.map((t,n)=>({id:""+(n+1),name:`Image ${n+1} / ${e.length}`,width:t.width,url:t.getAttribute("data-src"),type:"photo",height:t.height}))}function Ge(){return new Promise(e=>{var n;const o=document.createElement("dialog");o.id="alertDialog",o.style.cssText="\n      all: initial;\n      border: none !important;\n      border-radius: 8px !important;\n      padding: 24px !important;\n      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2) !important;\n      max-width: 420px !important;\n      width: 100% !important;\n      transform: translate(-50%, -50%) !important;\n      margin: 0px !important;\n      z-index: 99999999 !important;\n      position: fixed !important;\n      left: 50% !important;\n      top: 50% !important;\n      background-color: white !important;\n      display: grid !important;\n      gap: 16px !important;\n    ";const i=document.createElement("style");function r(){o.close(),document.body.removeChild(o),document.head.removeChild(i),e(null),o.removeEventListener("click",a)}function a(e){e.target===o&&r()}i.textContent="\n      #alertDialog::backdrop {\n        background: rgba(0, 0, 0, 0.5) !important;\n      }\n    ",document.head.appendChild(i),o.innerHTML='\n      <div class="header" style="\n        all: initial;\n        display: block !important;\n        font-family: \'Inter\', sans-serif !important;\n        font-feature-settings: normal !important;\n        font-size: 18px !important;\n        font-style: normal !important;\n        font-synthesis: weight none !important;\n        font-variation-settings: normal !important;\n        font-weight: 600 !important;\n        pointer-events: auto !important;\n        margin-bottom: 8px !important;\n      ">\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6" style="margin-right: 10px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>\n        <span>Image Download Permission</span>\n      </div>\n      <div class="description" style="\n        all: initial;\n        color: rgb(110, 110, 119) !important;\n        display: block !important;\n        font-family: \'Inter\', sans-serif !important;\n        font-feature-settings: normal !important;\n        font-size: 14px !important;\n        font-style: normal !important;\n        font-synthesis: weight none !important;\n        font-variation-settings: normal !important;\n        line-height: 20px !important;\n      ">\n        You\'ll be asked to grant permission to download images. Please allow it to proceed.\n      </div>\n      <div class="footer" style="all: initial; display: flex; justify-content: flex-end; gap: 10px;">\n        <button class="button" style="\n          all: initial;\n          align-items: center !important;\n          appearance: button !important;\n          background-color: rgb(24, 24, 27) !important;\n          border: none !important;\n          border-radius: 6px !important;\n          box-sizing: border-box !important;\n          color: rgb(250, 250, 250) !important;\n          cursor: pointer !important;\n          display: flex !important;\n          font-family: \'Inter\', sans-serif !important;\n          font-feature-settings: normal !important;\n          font-size: 14px !important;\n          font-style: normal !important;\n          font-weight: 500 !important;\n          justify-content: center !important;\n          line-height: 20px !important;\n          padding: 8px 16px !important;\n          text-align: center !important;\n          transition-duration: 0.15s !important;\n          transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color !important;\n          transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1) !important;\n          width: 100% !important;\n        ">OK</button>\n      </div>\n    ',document.body.appendChild(o),o.showModal(),t(r,"closeDialog"),t(a,"handleClickOutside"),o.addEventListener("click",a),null==(n=o.querySelector(".button"))||n.addEventListener("click",r)})}t(De,"handleMessage"),t(Ke,"watchCaptureV2"),t(Be,"iframeAsk"),t($e,"parseShortenedDate"),t(Fe,"getActualDate"),t(Ne,"convertAbbreviatedToNumber"),t(ze,"getTextOneOf"),t(He,"getMedias"),t(Ue,"querySelectorOneOf"),t(We,"parseSocialPost"),t(Re,"loadLinkedInPost"),t(Ve,"sleep"),t(Qe,"extractVisibleText"),t(Ye,"findMostVisibleElement"),t(Ze,"loadCarouselImages"),t(Ge,"showDownloadRemoteImagePermissionsAlert"),window.floatingManager=new Te;const Xe={getCarouselImages:async()=>{console.debug("getCarouselImages");const e=await Ze();return console.debug("getCarouselImages -> response",e),e}},Je={loadLinkedInPost:async()=>{const e=await Re();return console.debug("response",e),e},showDownloadRemoteImagePermissionsAlert:async()=>(await Ge(),await n("askDirectPermsToDownloadRemoteImages",{})),resizeModal:async e=>{window.modalManager.autoResize(e)},getHighlightRange:async()=>(await qe("highlight")).getHighlightRange(),closeModal:async()=>{window.modalManager.close()},closeTooltip:async()=>{window.modalManager.closeTooltip()},closeToast:async()=>{window.modalManager.closeToast()},clickedOutside:async()=>{window.modalManager.clickedOutside()},resizeIframe:async e=>{},showTooltip:async e=>{window.modalManager.showTooltip()},showToast:async()=>{window.modalManager.showToast()},ping:async()=>!0,showModal:async()=>{await window.modalManager.open()},startWatch:async e=>{window.quickCaptureWatcher.start(),console.log("init floating",e)},stopWatch:async()=>{window.quickCaptureWatcher.stop()},harvestWebPageContent:async()=>{},pickImageOnPage:async()=>(await qe("image")).pickImageOnPage(),takeCustomAreaScreenshot:async()=>(await qe("image")).takeCustomAreaScreenshot(),takeFullPageScreenshot:async()=>(await qe("image")).takeFullPageScreenshot(),takeFullScreenScreenshot:async()=>(await qe("image")).takeFullScreenScreenshot(),loadGmail:async({loadAllEmails:e})=>await r(e)};function et(){Ke()}t(et,"quickCapture"),console.log("opened quickcapture"),window.__stnModule={},et();
